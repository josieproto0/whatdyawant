<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Whatdyawant?</title>
    <!-- Supabase JS CDN, place this before your own scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/dist/umd/supabase.min.js"></script>
    <script src="supabase.js"></script>
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <div class="signup-container">
        <div class="logo">
            <div class="logo-icon">üéÅ</div>
            <h1>Whatdyawant?</h1>
        </div>

        <div class="welcome-text">
            <h2>Create Account</h2>
            <p>Start sharing your wishlist today</p>
        </div>

        <form id="signupForm">
            <div class="form-group">
                <label for="fullName">Full Name</label>
                <input type="text" id="fullName" placeholder="John Smith" required>
            </div>

            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="johnsmith" required pattern="[a-zA-Z0-9_]+" minlength="3">
                <div class="input-hint">Letters, numbers, and underscores only</div>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="you@example.com" required>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                <div class="input-hint">At least 6 characters</div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                <div id="passwordMatch" class="password-match"></div>
            </div>

            <div class="form-group">
                <label for="currency">Preferred Currency</label>
                <select id="currency" required>
                    <option value="">Select currency...</option>
                    <option value="GBP">¬£ GBP - British Pound</option>
                    <option value="USD">$ USD - US Dollar</option>
                    <option value="EUR">‚Ç¨ EUR - Euro</option>
                    <option value="NOK">kr NOK - Norwegian Krone</option>
                    <option value="SEK">kr SEK - Swedish Krona</option>
                    <option value="DKK">kr DKK - Danish Krone</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">
                Create Account
            </button>
        </form>

        <p class="link-text">
            Already have an account? <a href="login.html">Sign In</a>
        </p>
    </div>

    <script>
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const passwordMatch = document.getElementById('passwordMatch');

    // Check password match in real-time
    function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (confirmPassword === '') {
            passwordMatch.className = 'password-match';
            passwordMatch.textContent = '';
            return;
        }

        if (password === confirmPassword) {
            passwordMatch.className = 'password-match success';
            passwordMatch.textContent = '‚úì Passwords match';
        } else {
            passwordMatch.className = 'password-match error';
            passwordMatch.textContent = '‚úó Passwords do not match';
        }
    }

    confirmPasswordInput.addEventListener('input', checkPasswordMatch);
    passwordInput.addEventListener('input', checkPasswordMatch);

    // Supabase Signup
    document.getElementById('signupForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        // Validate passwords match
        if (password !== confirmPassword) {
            alert('Passwords do not match!');
            return;
        }

        // Get form data
        const fullName = document.getElementById('fullName').value;
        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const currency = document.getElementById('currency').value;

        // Supabase signup call!
        const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
            options: {
                data: {
                    fullName: fullName,
                    username: username,
                    currency: currency
                }
            }
        });

        if (error) {
            alert(error.message);
            console.log(error);
        } else {
            alert('Account created! Please check your email to confirm before logging in.');
            console.log(data); // For debugging
            window.location.href = 'login.html';
        }
    });

    // Username validation - only allow letters, numbers, underscores
    document.getElementById('username').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^a-zA-Z0-9_]/g, '');
    });
</script>
</body>
</html>
