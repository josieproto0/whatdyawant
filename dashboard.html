<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Whatdyawant?</title>
    <!-- Supabase JS CDN, place this before your own scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/dist/umd/supabase.min.js"></script>
    <script src="supabase.js"></script>
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">ğŸ</div>
                <h1>Whatdyawant?</h1>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item active">
                <span class="nav-icon">ğŸ </span>
                <span>Dashboard</span>
            </a>
            <a href="my-wishlist.html" class="nav-item">
                <span class="nav-icon">â¤ï¸</span>
                <span>My Wishlist</span>
            </a>
            <a href="friends-wishlists.html" class="nav-item">
                <span class="nav-icon">ğŸ‘¥</span>
                <span>Friends' Wishlists</span>
            </a>
            <a href="shopping-list.html" class="nav-item">
                <span class="nav-icon">ğŸ›ï¸</span>
                <span>My Shopping List</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <div class="user-name" id="userName">User</div>
                    <div class="user-email" id="userEmail">user@email.com</div>
                </div>
            </div>
            <div class="footer-buttons">
                <a href="settings.html" class="btn-small">
                    âš™ï¸ Settings
                </a>
                <button class="btn-small" onclick="logout()">
                    ğŸšª Logout
                </button>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <h2>Welcome Back! ğŸ‘‹</h2>
            <p>Manage your wishlist and see what your friends want</p>
        </div>

    <!-- Welcome Message Section -->
        <div class="welcome-message">
            <h2>ğŸ‘‹ Welcome to Whatdyawant?</h2>
            <p>
                This app helps you create, share, and claim gifts from wishlists with friends. 
                Your wishlist is shared with whomever you chose, they are able to save your wishlist and see updates. 
                You are unable to see if anybody has claimed your gifts and any claims are anonymous!
            </p>
            <div class="updates">
                <h4>Latest Features:</h4>
                <ul>
                    <li>ğŸ›ï¸  Add gift ideas to your shopping list</li>
                    <li>âœ… Filters and Sort</li>
                    <li>ğŸ Wishlists can now be viewed by logged out guest users</li>
                    <li>ğŸ” Guest users will not be able to see/make claims without signing in</li>
                    <li>ğŸ’¾ Save a wishlist link you were sent</li>
                </ul>
                <h4>Coming soon:</h4>
                <ul>
                    <li>ğŸ”— Autofill product details from pasted URLs</li>
                    <li>ğŸ–¼ï¸ Wishlist cover images and item photos</li>
                    <li>ğŸ“± Improved mobile experience</li>
                    <li>ğŸ” See gift ideas in list view</li>
                </ul>
            </div>
        </div>

        <!-- Share Wishlist Section -->
        <div class="share-section">
            <h3>Share Your Wishlist</h3>
            <p>Copy this link and share it with friends and family so they can see your wishes!</p>
            <div class="share-box">
                <input type="text" class="share-input" id="shareLink" readonly value="https://whatdyawant.app/wishlist-view.html?friend=your-unique-id">
                <button class="btn-share" onclick="copyShareLink()">ğŸ“‹ Copy Link</button>
            </div>
        </div>

        <!-- Dashboard Cards -->
        <div class="dashboard-grid">
            <div class="dashboard-card" onclick="location.href='my-wishlist.html'">
                <div class="card-icon green">â¤ï¸</div>
                <div class="card-title">My Wishlist</div>
                <div class="card-description">
                    Add, edit, and manage the items you'd love to receive. Your friends can claim them without you knowing!
                </div>
            </div>

            <div class="dashboard-card" onclick="location.href='friends-wishlists.html'">
                <div class="card-icon blue">ğŸ‘¥</div>
                <div class="card-title">Friends' Wishlists</div>
                <div class="card-description">
                    Browse and save your friends' wishlists. See what they want and claim gifts for them.
                </div>
            </div>

            <div class="dashboard-card" onclick="location.href='shopping-list.html'">
                <div class="card-icon purple">ğŸ›ï¸</div>
                <div class="card-title">My Shopping List</div>
                <div class="card-description">
                    View all the gifts you've claimed for others. Track your budget and mark items as purchased.
                </div>
            </div>
        </div>
    </main>

    <script>
                // Load user data from Supabase
        window.addEventListener('DOMContentLoaded', async function() {
            const { data: { user }, error } = await supabase.auth.getUser();

            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            const userMeta = user.user_metadata || {};
            const fullName = userMeta.fullName || user.email.split('@')[0];
            const username = userMeta.username || user.email.split('@')[0];
            const userEmail = user.email;

            // Set Avatar and Share Link 
            document.getElementById('userName').textContent = fullName;
            document.getElementById('userEmail').textContent = userEmail;
            document.getElementById('userAvatar').textContent = fullName[0].toUpperCase();
            document.getElementById('shareLink').value = `https://josieproto0.github.io/whatdyawant/wishlist-view.html?friend=${username}`;
        });

        // Toggle sidebar on mobile
    function toggleSidebar() {  
    document.getElementById('sidebar').classList.toggle('active');
}

        // Copy share link
        function copyShareLink() {
            const shareLink = document.getElementById('shareLink');
            shareLink.select();
            shareLink.setSelectionRange(0, 99999); // For mobile

            navigator.clipboard.writeText(shareLink.value).then(function() {
                alert('âœ“ Link copied to clipboard!');
            }).catch(function() {
                document.execCommand('copy');
                alert('âœ“ Link copied to clipboard!');
            });
        }

        // Logout function
        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                await supabase.auth.signOut();
                window.location.href = 'login.html';
            }
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const menuBtn = document.querySelector('.mobile-menu-btn');

            if (window.innerWidth <= 768) {
                if (!sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            }
        });
        </script>
</body>
</html>
